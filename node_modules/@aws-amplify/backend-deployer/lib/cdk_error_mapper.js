import { AmplifyError, AmplifyFault, AmplifyUserError, } from '@aws-amplify/platform-core';
/**
 * Transforms CDK error messages to human readable ones
 */
export class CdkErrorMapper {
    formatter;
    multiLineEolRegex = '[\r\n]+';
    /**
     * Instantiate with a formatter that will be used for formatting CLI commands in error messages
     */
    constructor(formatter) {
        this.formatter = formatter;
    }
    getAmplifyError = (error) => {
        let underlyingError = error;
        // Check if there was an Amplify error thrown during child process execution
        const amplifyError = AmplifyError.fromStderr(error.message);
        if (amplifyError) {
            return amplifyError;
        }
        const matchingError = this.getKnownErrors().find((knownError) => knownError.errorRegex.test(error.message));
        if (matchingError) {
            // Extract meaningful contextual information if available
            const matchGroups = error.message.match(matchingError.errorRegex);
            if (matchGroups && matchGroups.length > 1) {
                // If the contextual information can be used in the error message use it, else consider it as a downstream cause
                if (matchGroups.groups) {
                    for (const [key, value] of Object.entries(matchGroups.groups)) {
                        const placeHolder = `{${key}}`;
                        if (matchingError.humanReadableErrorMessage.includes(placeHolder)) {
                            matchingError.humanReadableErrorMessage =
                                matchingError.humanReadableErrorMessage.replace(placeHolder, value);
                            // reset the stderr dump in the underlying error
                            underlyingError = undefined;
                        }
                    }
                }
                else {
                    underlyingError.message = matchGroups[0];
                }
            }
            return matchingError.classification === 'ERROR'
                ? new AmplifyUserError(matchingError.errorName, {
                    message: matchingError.humanReadableErrorMessage,
                    resolution: matchingError.resolutionMessage,
                }, underlyingError)
                : new AmplifyFault(matchingError.errorName, {
                    message: matchingError.humanReadableErrorMessage,
                    resolution: matchingError.resolutionMessage,
                }, underlyingError);
        }
        return AmplifyError.fromError(error);
    };
    getKnownErrors = () => [
        {
            errorRegex: /ExpiredToken/,
            humanReadableErrorMessage: 'The security token included in the request is invalid.',
            resolutionMessage: 'Ensure your local AWS credentials are valid.',
            errorName: 'ExpiredTokenError',
            classification: 'ERROR',
        },
        {
            errorRegex: /Access Denied/,
            humanReadableErrorMessage: 'The deployment role does not have sufficient permissions to perform this deployment.',
            resolutionMessage: 'Ensure your deployment role has the AmplifyBackendDeployFullAccess role along with any additional permissions required to deploy your backend definition.',
            errorName: 'AccessDeniedError',
            classification: 'ERROR',
        },
        {
            errorRegex: /(Has the environment been bootstrapped)|(Is account \d+ bootstrapped)|(Is this account bootstrapped)/,
            humanReadableErrorMessage: 'This AWS account and region has not been bootstrapped.',
            resolutionMessage: 'Run `cdk bootstrap aws://{YOUR_ACCOUNT_ID}/{YOUR_REGION}` locally to resolve this.',
            errorName: 'BootstrapNotDetectedError',
            classification: 'ERROR',
        },
        {
            errorRegex: new RegExp(`(SyntaxError|ReferenceError|TypeError):((?:.|${this.multiLineEolRegex})*?at .*)`),
            humanReadableErrorMessage: 'Unable to build the Amplify backend definition.',
            resolutionMessage: 'Check your backend definition in the `amplify` folder for syntax and type errors.',
            errorName: 'SyntaxError',
            classification: 'ERROR',
        },
        {
            errorRegex: /Unable to resolve AWS account to use/,
            humanReadableErrorMessage: 'Unable to resolve AWS account to use. It must be either configured when you define your CDK Stack, or through the environment',
            resolutionMessage: 'You can retry your last request as this is most likely a transient issue: https://github.com/aws/aws-cdk/issues/24744. If the error persists ensure your local AWS credentials are valid.',
            errorName: 'CDKResolveAWSAccountError',
            classification: 'ERROR',
        },
        {
            errorRegex: /EACCES(.*)/,
            humanReadableErrorMessage: 'File permissions error',
            resolutionMessage: 'Check that you have the right access permissions to the mentioned file',
            errorName: 'FilePermissionsError',
            classification: 'ERROR',
        },
        {
            errorRegex: new RegExp(`\\[ERR_MODULE_NOT_FOUND\\]:(.*)${this.multiLineEolRegex}|Error: Cannot find module (.*)`),
            humanReadableErrorMessage: 'Cannot find module',
            resolutionMessage: 'Check your backend definition in the `amplify` folder for missing file or package imports. Try installing them with your package manager.',
            errorName: 'ModuleNotFoundError',
            classification: 'ERROR',
        },
        {
            // Truncate the cdk error message's second line (Invoke the CLI in sequence, or use '--output' to synth into different directories.)
            errorRegex: /Another CLI (.*) is currently(.*)\. |Other CLIs (.*) are currently reading from(.*)\. /,
            humanReadableErrorMessage: 'Multiple sandbox instances detected.',
            resolutionMessage: 'Make sure only one instance of sandbox is running for this project',
            errorName: 'MultipleSandboxInstancesError',
            classification: 'ERROR',
        },
        {
            // Also extracts the first line in the stack where the error happened
            errorRegex: new RegExp(`\\[esbuild Error\\]: ((?:.|${this.multiLineEolRegex})*?at .*)`),
            humanReadableErrorMessage: 'Unable to build the Amplify backend definition.',
            resolutionMessage: 'Check your backend definition in the `amplify` folder for syntax and type errors.',
            errorName: 'ESBuildError',
            classification: 'ERROR',
        },
        {
            errorRegex: new RegExp(`\\[TransformError\\]: Transform failed with .* error:${this.multiLineEolRegex}(?<esBuildErrorMessage>.*)`),
            humanReadableErrorMessage: '{esBuildErrorMessage}',
            resolutionMessage: 'Fix the above mentioned type or syntax error in your backend definition.',
            errorName: 'ESBuildError',
            classification: 'ERROR',
        },
        {
            errorRegex: /Amplify Backend not found in/,
            humanReadableErrorMessage: 'Backend definition could not be found in amplify directory.',
            resolutionMessage: 'Ensure that the amplify/backend.(ts|js) file exists',
            errorName: 'FileConventionError',
            classification: 'ERROR',
        },
        {
            errorRegex: /Amplify (.*) must be defined in (.*)/,
            humanReadableErrorMessage: 'File name or path for backend definition are incorrect.',
            resolutionMessage: 'Ensure that the amplify/backend.(ts|js) file exists',
            errorName: 'FileConventionError',
            classification: 'ERROR',
        },
        {
            errorRegex: /Updates are not allowed for property/,
            humanReadableErrorMessage: 'The changes that you are trying to apply are not supported.',
            resolutionMessage: 'The resources referenced in the error message must be deleted and recreated to apply the changes.',
            errorName: 'CFNUpdateNotSupportedError',
            classification: 'ERROR',
        },
        {
            // This error originates from Cognito service when user tries to change UserPool attributes which is not allowed
            // https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html
            // Remapping to `UpdateNotSupported` will allow sandbox to prompt users for resetting their environment
            errorRegex: /Invalid AttributeDataType input, consider using the provided AttributeDataType enum/,
            humanReadableErrorMessage: 'User pool attributes cannot be changed after a user pool has been created.',
            resolutionMessage: 'To change these attributes, remove `defineAuth` from your backend, deploy, then add it back. Note that removing `defineAuth` and deploying will delete any users stored in your UserPool.',
            errorName: 'CFNUpdateNotSupportedError',
            classification: 'ERROR',
        },
        {
            // Error: .* is printed to stderr during cdk synth
            // Also extracts the first line in the stack where the error happened
            errorRegex: new RegExp(`^Error: (.*${this.multiLineEolRegex}.*at.*)`, 'm'),
            humanReadableErrorMessage: 'Unable to build the Amplify backend definition.',
            resolutionMessage: 'Check your backend definition in the `amplify` folder for syntax and type errors.',
            errorName: 'BackendSynthError',
            classification: 'ERROR',
        },
        {
            // "Catch all": the backend entry point file is referenced in the stack indicating a problem in customer code
            errorRegex: /amplify\/backend/,
            humanReadableErrorMessage: 'Unable to build Amplify backend.',
            resolutionMessage: 'Check your backend definition in the `amplify` folder for syntax and type errors.',
            errorName: 'BackendBuildError',
            classification: 'ERROR',
        },
        {
            // We capture the parameter name to show relevant error message
            errorRegex: /Failed to retrieve backend secret (?<secretName>.*) for.*ParameterNotFound/,
            humanReadableErrorMessage: `The secret {secretName} specified in the backend does not exist.`,
            resolutionMessage: `Create secrets using the command ${this.formatter.normalizeAmpxCommand('sandbox secret set')}. For more information, see https://docs.amplify.aws/gen2/deploy-and-host/sandbox-environments/features/#set-secrets`,
            errorName: 'SecretNotSetError',
            classification: 'ERROR',
        },
        {
            // Note that the order matters, this should be the last as it captures generic CFN error
            errorRegex: new RegExp(`Deployment failed: (.*)${this.multiLineEolRegex}`),
            humanReadableErrorMessage: 'The CloudFormation deployment has failed.',
            resolutionMessage: 'Find more information in the CloudFormation AWS Console for this stack.',
            errorName: 'CloudFormationDeploymentError',
            classification: 'ERROR',
        },
    ];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2RrX2Vycm9yX21hcHBlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9jZGtfZXJyb3JfbWFwcGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxZQUFZLEVBRVosWUFBWSxFQUNaLGdCQUFnQixHQUNqQixNQUFNLDRCQUE0QixDQUFDO0FBR3BDOztHQUVHO0FBQ0gsTUFBTSxPQUFPLGNBQWM7SUFLSTtJQUpyQixpQkFBaUIsR0FBRyxTQUFTLENBQUM7SUFDdEM7O09BRUc7SUFDSCxZQUE2QixTQUF5QztRQUF6QyxjQUFTLEdBQVQsU0FBUyxDQUFnQztJQUFHLENBQUM7SUFFMUUsZUFBZSxHQUFHLENBQ2hCLEtBQVksRUFDK0IsRUFBRTtRQUM3QyxJQUFJLGVBQWUsR0FBc0IsS0FBSyxDQUFDO1FBRS9DLDRFQUE0RTtRQUM1RSxNQUFNLFlBQVksR0FBRyxZQUFZLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM1RCxJQUFJLFlBQVksRUFBRTtZQUNoQixPQUFPLFlBQVksQ0FBQztTQUNyQjtRQUVELE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUM5RCxVQUFVLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQzFDLENBQUM7UUFFRixJQUFJLGFBQWEsRUFBRTtZQUNqQix5REFBeUQ7WUFDekQsTUFBTSxXQUFXLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRWxFLElBQUksV0FBVyxJQUFJLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUN6QyxnSEFBZ0g7Z0JBQ2hILElBQUksV0FBVyxDQUFDLE1BQU0sRUFBRTtvQkFDdEIsS0FBSyxNQUFNLENBQUMsR0FBRyxFQUFFLEtBQUss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QW1wbGlmeUVycm9yQ2xhc3NpZmljYXRpb24sXG4gIEFtcGxpZnlGYXVsdCxcbiAgQW1wbGlmeVVzZXJFcnJvcixcbn0gZnJvbSAnQGF3cy1hbXBsaWZ5L3BsYXRmb3JtLWNvcmUnO1xuaW1wb3J0IHsgQmFja2VuZERlcGxveWVyT3V0cHV0Rm9ybWF0dGVyIH0gZnJvbSAnLi90eXBlcy5qcyc7XG5cbi8qKlxuICogVHJhbnNmb3JtcyBDREsgZXJyb3IgbWVzc2FnZXMgdG8gaHVtYW4gcmVhZGFibGUgb25lc1xuICovXG5leHBvcnQgY2xhc3MgQ2RrRXJyb3JNYXBwZXIge1xuICBwcml2YXRlIG11bHRpTGluZUVvbFJlZ2V4ID0gJ1tcXHJcXG5dKyc7XG4gIC8qKlxuICAgKiBJbnN0YW50aWF0ZSB3aXRoIGEgZm9ybWF0dGVyIHRoYXQgd2lsbCBiZSB1c2VkIGZvciBmb3JtYXR0aW5nIENMSSBjb21tYW5kcyBpbiBlcnJvciBtZXNzYWdlc1xuICAgKi9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBmb3JtYXR0ZXI6IEJhY2tlbmREZXBsb3llck91dHB1dEZvcm1hdHRlcikge31cblxuICBnZXRBbXBsaWZ5RXJyb3IgPSAoXG4gICAgZXJyb3I6IEVycm9yXG4gICk6IEFtcGxpZnlFcnJvcjxDREtEZXBsb3ltZW50RXJyb3IgfCBzdHJpbmc+ID0+IHtcbiAgICBsZXQgdW5kZXJseWluZ0Vycm9yOiBFcnJvciB8IHVuZGVmaW5lZCA9IGVycm9yO1xuXG4gICAgLy8gQ2hlY2sgaWYgdGhlcmUgd2FzIGFuIEFtcGxpZnkgZXJyb3IgdGhyb3duIGR1cmluZyBjaGlsZCBwcm9jZXNzIGV4ZWN1dGlvblxuICAgIGNvbnN0IGFtcGxpZnlFcnJvciA9IEFtcGxpZnlFcnJvci5mcm9tU3RkZXJyKGVycm9yLm1lc3NhZ2UpO1xuICAgIGlmIChhbXBsaWZ5RXJyb3IpIHtcbiAgICAgIHJldHVybiBhbXBsaWZ5RXJyb3I7XG4gICAgfVxuXG4gICAgY29uc3QgbWF0Y2hpbmdFcnJvciA9IHRoaXMuZ2V0S25vd25FcnJvcnMoKS5maW5kKChrbm93bkVycm9yKSA9PlxuICAgICAga25vd25FcnJvci5lcnJvclJlZ2V4LnRlc3QoZXJyb3IubWVzc2FnZSlcbiAgICApO1xuXG4gICAgaWYgKG1hdGNoaW5nRXJyb3IpIHtcbiAgICAgIC8vIEV4dHJhY3QgbWVhbmluZ2Z1bCBjb250ZXh0dWFsIGluZm9ybWF0aW9uIGlmIGF2YWlsYWJsZVxuICAgICAgY29uc3QgbWF0Y2hHcm91cHMgPSBlcnJvci5tZXNzYWdlLm1hdGNoKG1hdGNoaW5nRXJyb3IuZXJyb3JSZWdleCk7XG5cbiAgICAgIGlmIChtYXRjaEdyb3VwcyAmJiBtYXRjaEdyb3Vwcy5sZW5ndGggPiAxKSB7XG4gICAgICAgIC8vIElmIHRoZSBjb250ZXh0dWFsIGluZm9ybWF0aW9uIGNhbiBiZSB1c2VkIGluIHRoZSBlcnJvciBtZXNzYWdlIHVzZSBpdCwgZWxzZSBjb25zaWRlciBpdCBhcyBhIGRvd25zdHJlYW0gY2F1c2VcbiAgICAgICAgaWYgKG1hdGNoR3JvdXBzLmdyb3Vwcykge1xuICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKG1hdGNoR3JvdXBzLmdyb3VwcykpIHtcbiAgICAgICAgICAgIGNvbnN0IHBsYWNlSG9sZGVyID0gYHske2tleX19YDtcbiAgICAgICAgICAgIGlmIChtYXRjaGluZ0Vycm9yLmh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2UuaW5jbHVkZXMocGxhY2VIb2xkZXIpKSB7XG4gICAgICAgICAgICAgIG1hdGNoaW5nRXJyb3IuaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZSA9XG4gICAgICAgICAgICAgICAgbWF0Y2hpbmdFcnJvci5odW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlLnJlcGxhY2UoXG4gICAgICAgICAgICAgICAgICBwbGFjZUhvbGRlcixcbiAgICAgICAgICAgICAgICAgIHZhbHVlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgLy8gcmVzZXQgdGhlIHN0ZGVyciBkdW1wIGluIHRoZSB1bmRlcmx5aW5nIGVycm9yXG4gICAgICAgICAgICAgIHVuZGVybHlpbmdFcnJvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdW5kZXJseWluZ0Vycm9yLm1lc3NhZ2UgPSBtYXRjaEdyb3Vwc1swXTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gbWF0Y2hpbmdFcnJvci5jbGFzc2lmaWNhdGlvbiA9PT0gJ0VSUk9SJ1xuICAgICAgICA/IG5ldyBBbXBsaWZ5VXNlckVycm9yKFxuICAgICAgICAgICAgbWF0Y2hpbmdFcnJvci5lcnJvck5hbWUsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG1lc3NhZ2U6IG1hdGNoaW5nRXJyb3IuaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZSxcbiAgICAgICAgICAgICAgcmVzb2x1dGlvbjogbWF0Y2hpbmdFcnJvci5yZXNvbHV0aW9uTWVzc2FnZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1bmRlcmx5aW5nRXJyb3JcbiAgICAgICAgICApXG4gICAgICAgIDogbmV3IEFtcGxpZnlGYXVsdChcbiAgICAgICAgICAgIG1hdGNoaW5nRXJyb3IuZXJyb3JOYW1lLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBtZXNzYWdlOiBtYXRjaGluZ0Vycm9yLmh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2UsXG4gICAgICAgICAgICAgIHJlc29sdXRpb246IG1hdGNoaW5nRXJyb3IucmVzb2x1dGlvbk1lc3NhZ2UsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdW5kZXJseWluZ0Vycm9yXG4gICAgICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIEFtcGxpZnlFcnJvci5mcm9tRXJyb3IoZXJyb3IpO1xuICB9O1xuXG4gIHByaXZhdGUgZ2V0S25vd25FcnJvcnMgPSAoKTogQXJyYXk8e1xuICAgIGVycm9yUmVnZXg6IFJlZ0V4cDtcbiAgICBodW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlOiBzdHJpbmc7XG4gICAgcmVzb2x1dGlvbk1lc3NhZ2U6IHN0cmluZztcbiAgICBlcnJvck5hbWU6IENES0RlcGxveW1lbnRFcnJvcjtcbiAgICBjbGFzc2lmaWNhdGlvbjogQW1wbGlmeUVycm9yQ2xhc3NpZmljYXRpb247XG4gIH0+ID0+IFtcbiAgICB7XG4gICAgICBlcnJvclJlZ2V4OiAvRXhwaXJlZFRva2VuLyxcbiAgICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6XG4gICAgICAgICdUaGUgc2VjdXJpdHkgdG9rZW4gaW5jbHVkZWQgaW4gdGhlIHJlcXVlc3QgaXMgaW52YWxpZC4nLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6ICdFbnN1cmUgeW91ciBsb2NhbCBBV1MgY3JlZGVudGlhbHMgYXJlIHZhbGlkLicsXG4gICAgICBlcnJvck5hbWU6ICdFeHBpcmVkVG9rZW5FcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGVycm9yUmVnZXg6IC9BY2Nlc3MgRGVuaWVkLyxcbiAgICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6XG4gICAgICAgICdUaGUgZGVwbG95bWVudCByb2xlIGRvZXMgbm90IGhhdmUgc3VmZmljaWVudCBwZXJtaXNzaW9ucyB0byBwZXJmb3JtIHRoaXMgZGVwbG95bWVudC4nLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6XG4gICAgICAgICdFbnN1cmUgeW91ciBkZXBsb3ltZW50IHJvbGUgaGFzIHRoZSBBbXBsaWZ5QmFja2VuZERlcGxveUZ1bGxBY2Nlc3Mgcm9sZSBhbG9uZyB3aXRoIGFueSBhZGRpdGlvbmFsIHBlcm1pc3Npb25zIHJlcXVpcmVkIHRvIGRlcGxveSB5b3VyIGJhY2tlbmQgZGVmaW5pdGlvbi4nLFxuICAgICAgZXJyb3JOYW1lOiAnQWNjZXNzRGVuaWVkRXJyb3InLFxuICAgICAgY2xhc3NpZmljYXRpb246ICdFUlJPUicsXG4gICAgfSxcbiAgICB7XG4gICAgICBlcnJvclJlZ2V4OlxuICAgICAgICAvKEhhcyB0aGUgZW52aXJvbm1lbnQgYmVlbiBib290c3RyYXBwZWQpfChJcyBhY2NvdW50IFxcZCsgYm9vdHN0cmFwcGVkKXwoSXMgdGhpcyBhY2NvdW50IGJvb3RzdHJhcHBlZCkvLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTpcbiAgICAgICAgJ1RoaXMgQVdTIGFjY291bnQgYW5kIHJlZ2lvbiBoYXMgbm90IGJlZW4gYm9vdHN0cmFwcGVkLicsXG4gICAgICByZXNvbHV0aW9uTWVzc2FnZTpcbiAgICAgICAgJ1J1biBgY2RrIGJvb3RzdHJhcCBhd3M6Ly97WU9VUl9BQ0NPVU5UX0lEfS97WU9VUl9SRUdJT059YCBsb2NhbGx5IHRvIHJlc29sdmUgdGhpcy4nLFxuICAgICAgZXJyb3JOYW1lOiAnQm9vdHN0cmFwTm90RGV0ZWN0ZWRFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGVycm9yUmVnZXg6IG5ldyBSZWdFeHAoXG4gICAgICAgIGAoU3ludGF4RXJyb3J8UmVmZXJlbmNlRXJyb3J8VHlwZUVycm9yKTooKD86Lnwke3RoaXMubXVsdGlMaW5lRW9sUmVnZXh9KSo/YXQgLiopYFxuICAgICAgKSxcbiAgICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6XG4gICAgICAgICdVbmFibGUgdG8gYnVpbGQgdGhlIEFtcGxpZnkgYmFja2VuZCBkZWZpbml0aW9uLicsXG4gICAgICByZXNvbHV0aW9uTWVzc2FnZTpcbiAgICAgICAgJ0NoZWNrIHlvdXIgYmFja2VuZCBkZWZpbml0aW9uIGluIHRoZSBgYW1wbGlmeWAgZm9sZGVyIGZvciBzeW50YXggYW5kIHR5cGUgZXJyb3JzLicsXG4gICAgICBlcnJvck5hbWU6ICdTeW50YXhFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGVycm9yUmVnZXg6IC9VbmFibGUgdG8gcmVzb2x2ZSBBV1MgYWNjb3VudCB0byB1c2UvLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTpcbiAgICAgICAgJ1VuYWJsZSB0byByZXNvbHZlIEFXUyBhY2NvdW50IHRvIHVzZS4gSXQgbXVzdCBiZSBlaXRoZXIgY29uZmlndXJlZCB3aGVuIHlvdSBkZWZpbmUgeW91ciBDREsgU3RhY2ssIG9yIHRocm91Z2ggdGhlIGVudmlyb25tZW50JyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnWW91IGNhbiByZXRyeSB5b3VyIGxhc3QgcmVxdWVzdCBhcyB0aGlzIGlzIG1vc3QgbGlrZWx5IGEgdHJhbnNpZW50IGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vYXdzL2F3cy1jZGsvaXNzdWVzLzI0NzQ0LiBJZiB0aGUgZXJyb3IgcGVyc2lzdHMgZW5zdXJlIHlvdXIgbG9jYWwgQVdTIGNyZWRlbnRpYWxzIGFyZSB2YWxpZC4nLFxuICAgICAgZXJyb3JOYW1lOiAnQ0RLUmVzb2x2ZUFXU0FjY291bnRFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGVycm9yUmVnZXg6IC9FQUNDRVMoLiopLyxcbiAgICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6ICdGaWxlIHBlcm1pc3Npb25zIGVycm9yJyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnQ2hlY2sgdGhhdCB5b3UgaGF2ZSB0aGUgcmlnaHQgYWNjZXNzIHBlcm1pc3Npb25zIHRvIHRoZSBtZW50aW9uZWQgZmlsZScsXG4gICAgICBlcnJvck5hbWU6ICdGaWxlUGVybWlzc2lvbnNFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGVycm9yUmVnZXg6IG5ldyBSZWdFeHAoXG4gICAgICAgIGBcXFxcW0VSUl9NT0RVTEVfTk9UX0ZPVU5EXFxcXF06KC4qKSR7dGhpcy5tdWx0aUxpbmVFb2xSZWdleH18RXJyb3I6IENhbm5vdCBmaW5kIG1vZHVsZSAoLiopYFxuICAgICAgKSxcbiAgICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6ICdDYW5ub3QgZmluZCBtb2R1bGUnLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6XG4gICAgICAgICdDaGVjayB5b3VyIGJhY2tlbmQgZGVmaW5pdGlvbiBpbiB0aGUgYGFtcGxpZnlgIGZvbGRlciBmb3IgbWlzc2luZyBmaWxlIG9yIHBhY2thZ2UgaW1wb3J0cy4gVHJ5IGluc3RhbGxpbmcgdGhlbSB3aXRoIHlvdXIgcGFja2FnZSBtYW5hZ2VyLicsXG4gICAgICBlcnJvck5hbWU6ICdNb2R1bGVOb3RGb3VuZEVycm9yJyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiAnRVJST1InLFxuICAgIH0sXG4gICAge1xuICAgICAgLy8gVHJ1bmNhdGUgdGhlIGNkayBlcnJvciBtZXNzYWdlJ3Mgc2Vjb25kIGxpbmUgKEludm9rZSB0aGUgQ0xJIGluIHNlcXVlbmNlLCBvciB1c2UgJy0tb3V0cHV0JyB0byBzeW50aCBpbnRvIGRpZmZlcmVudCBkaXJlY3Rvcmllcy4pXG4gICAgICBlcnJvclJlZ2V4OlxuICAgICAgICAvQW5vdGhlciBDTEkgKC4qKSBpcyBjdXJyZW50bHkoLiopXFwuIHxPdGhlciBDTElzICguKikgYXJlIGN1cnJlbnRseSByZWFkaW5nIGZyb20oLiopXFwuIC8sXG4gICAgICBodW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlOiAnTXVsdGlwbGUgc2FuZGJveCBpbnN0YW5jZXMgZGV0ZWN0ZWQuJyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnTWFrZSBzdXJlIG9ubHkgb25lIGluc3RhbmNlIG9mIHNhbmRib3ggaXMgcnVubmluZyBmb3IgdGhpcyBwcm9qZWN0JyxcbiAgICAgIGVycm9yTmFtZTogJ011bHRpcGxlU2FuZGJveEluc3RhbmNlc0Vycm9yJyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiAnRVJST1InLFxuICAgIH0sXG4gICAge1xuICAgICAgLy8gQWxzbyBleHRyYWN0cyB0aGUgZmlyc3QgbGluZSBpbiB0aGUgc3RhY2sgd2hlcmUgdGhlIGVycm9yIGhhcHBlbmVkXG4gICAgICBlcnJvclJlZ2V4OiBuZXcgUmVnRXhwKFxuICAgICAgICBgXFxcXFtlc2J1aWxkIEVycm9yXFxcXF06ICgoPzoufCR7dGhpcy5tdWx0aUxpbmVFb2xSZWdleH0pKj9hdCAuKilgXG4gICAgICApLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTpcbiAgICAgICAgJ1VuYWJsZSB0byBidWlsZCB0aGUgQW1wbGlmeSBiYWNrZW5kIGRlZmluaXRpb24uJyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnQ2hlY2sgeW91ciBiYWNrZW5kIGRlZmluaXRpb24gaW4gdGhlIGBhbXBsaWZ5YCBmb2xkZXIgZm9yIHN5bnRheCBhbmQgdHlwZSBlcnJvcnMuJyxcbiAgICAgIGVycm9yTmFtZTogJ0VTQnVpbGRFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGVycm9yUmVnZXg6IG5ldyBSZWdFeHAoXG4gICAgICAgIGBcXFxcW1RyYW5zZm9ybUVycm9yXFxcXF06IFRyYW5zZm9ybSBmYWlsZWQgd2l0aCAuKiBlcnJvcjoke3RoaXMubXVsdGlMaW5lRW9sUmVnZXh9KD88ZXNCdWlsZEVycm9yTWVzc2FnZT4uKilgXG4gICAgICApLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTogJ3tlc0J1aWxkRXJyb3JNZXNzYWdlfScsXG4gICAgICByZXNvbHV0aW9uTWVzc2FnZTpcbiAgICAgICAgJ0ZpeCB0aGUgYWJvdmUgbWVudGlvbmVkIHR5cGUgb3Igc3ludGF4IGVycm9yIGluIHlvdXIgYmFja2VuZCBkZWZpbml0aW9uLicsXG4gICAgICBlcnJvck5hbWU6ICdFU0J1aWxkRXJyb3InLFxuICAgICAgY2xhc3NpZmljYXRpb246ICdFUlJPUicsXG4gICAgfSxcbiAgICB7XG4gICAgICBlcnJvclJlZ2V4OiAvQW1wbGlmeSBCYWNrZW5kIG5vdCBmb3VuZCBpbi8sXG4gICAgICBodW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlOlxuICAgICAgICAnQmFja2VuZCBkZWZpbml0aW9uIGNvdWxkIG5vdCBiZSBmb3VuZCBpbiBhbXBsaWZ5IGRpcmVjdG9yeS4nLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6ICdFbnN1cmUgdGhhdCB0aGUgYW1wbGlmeS9iYWNrZW5kLih0c3xqcykgZmlsZSBleGlzdHMnLFxuICAgICAgZXJyb3JOYW1lOiAnRmlsZUNvbnZlbnRpb25FcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGVycm9yUmVnZXg6IC9BbXBsaWZ5ICguKikgbXVzdCBiZSBkZWZpbmVkIGluICguKikvLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTpcbiAgICAgICAgJ0ZpbGUgbmFtZSBvciBwYXRoIGZvciBiYWNrZW5kIGRlZmluaXRpb24gYXJlIGluY29ycmVjdC4nLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6ICdFbnN1cmUgdGhhdCB0aGUgYW1wbGlmeS9iYWNrZW5kLih0c3xqcykgZmlsZSBleGlzdHMnLFxuICAgICAgZXJyb3JOYW1lOiAnRmlsZUNvbnZlbnRpb25FcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGVycm9yUmVnZXg6IC9VcGRhdGVzIGFyZSBub3QgYWxsb3dlZCBmb3IgcHJvcGVydHkvLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTpcbiAgICAgICAgJ1RoZSBjaGFuZ2VzIHRoYXQgeW91IGFyZSB0cnlpbmcgdG8gYXBwbHkgYXJlIG5vdCBzdXBwb3J0ZWQuJyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnVGhlIHJlc291cmNlcyByZWZlcmVuY2VkIGluIHRoZSBlcnJvciBtZXNzYWdlIG11c3QgYmUgZGVsZXRlZCBhbmQgcmVjcmVhdGVkIHRvIGFwcGx5IHRoZSBjaGFuZ2VzLicsXG4gICAgICBlcnJvck5hbWU6ICdDRk5VcGRhdGVOb3RTdXBwb3J0ZWRFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIC8vIFRoaXMgZXJyb3Igb3JpZ2luYXRlcyBmcm9tIENvZ25pdG8gc2VydmljZSB3aGVuIHVzZXIgdHJpZXMgdG8gY2hhbmdlIFVzZXJQb29sIGF0dHJpYnV0ZXMgd2hpY2ggaXMgbm90IGFsbG93ZWRcbiAgICAgIC8vIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9jb2duaXRvL2xhdGVzdC9kZXZlbG9wZXJndWlkZS91c2VyLXBvb2wtc2V0dGluZ3MtYXR0cmlidXRlcy5odG1sXG4gICAgICAvLyBSZW1hcHBpbmcgdG8gYFVwZGF0ZU5vdFN1cHBvcnRlZGAgd2lsbCBhbGxvdyBzYW5kYm94IHRvIHByb21wdCB1c2VycyBmb3IgcmVzZXR0aW5nIHRoZWlyIGVudmlyb25tZW50XG4gICAgICBlcnJvclJlZ2V4OlxuICAgICAgICAvSW52YWxpZCBBdHRyaWJ1dGVEYXRhVHlwZSBpbnB1dCwgY29uc2lkZXIgdXNpbmcgdGhlIHByb3ZpZGVkIEF0dHJpYnV0ZURhdGFUeXBlIGVudW0vLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTpcbiAgICAgICAgJ1VzZXIgcG9vbCBhdHRyaWJ1dGVzIGNhbm5vdCBiZSBjaGFuZ2VkIGFmdGVyIGEgdXNlciBwb29sIGhhcyBiZWVuIGNyZWF0ZWQuJyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnVG8gY2hhbmdlIHRoZXNlIGF0dHJpYnV0ZXMsIHJlbW92ZSBgZGVmaW5lQXV0aGAgZnJvbSB5b3VyIGJhY2tlbmQsIGRlcGxveSwgdGhlbiBhZGQgaXQgYmFjay4gTm90ZSB0aGF0IHJlbW92aW5nIGBkZWZpbmVBdXRoYCBhbmQgZGVwbG95aW5nIHdpbGwgZGVsZXRlIGFueSB1c2VycyBzdG9yZWQgaW4geW91ciBVc2VyUG9vbC4nLFxuICAgICAgZXJyb3JOYW1lOiAnQ0ZOVXBkYXRlTm90U3VwcG9ydGVkRXJyb3InLFxuICAgICAgY2xhc3NpZmljYXRpb246ICdFUlJPUicsXG4gICAgfSxcbiAgICB7XG4gICAgICAvLyBFcnJvcjogLiogaXMgcHJpbnRlZCB0byBzdGRlcnIgZHVyaW5nIGNkayBzeW50aFxuICAgICAgLy8gQWxzbyBleHRyYWN0cyB0aGUgZmlyc3QgbGluZSBpbiB0aGUgc3RhY2sgd2hlcmUgdGhlIGVycm9yIGhhcHBlbmVkXG4gICAgICBlcnJvclJlZ2V4OiBuZXcgUmVnRXhwKFxuICAgICAgICBgXkVycm9yOiAoLioke3RoaXMubXVsdGlMaW5lRW9sUmVnZXh9LiphdC4qKWAsXG4gICAgICAgICdtJ1xuICAgICAgKSxcbiAgICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6XG4gICAgICAgICdVbmFibGUgdG8gYnVpbGQgdGhlIEFtcGxpZnkgYmFja2VuZCBkZWZpbml0aW9uLicsXG4gICAgICByZXNvbHV0aW9uTWVzc2FnZTpcbiAgICAgICAgJ0NoZWNrIHlvdXIgYmFja2VuZCBkZWZpbml0aW9uIGluIHRoZSBgYW1wbGlmeWAgZm9sZGVyIGZvciBzeW50YXggYW5kIHR5cGUgZXJyb3JzLicsXG4gICAgICBlcnJvck5hbWU6ICdCYWNrZW5kU3ludGhFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIC8vIFwiQ2F0Y2ggYWxsXCI6IHRoZSBiYWNrZW5kIGVudHJ5IHBvaW50IGZpbGUgaXMgcmVmZXJlbmNlZCBpbiB0aGUgc3RhY2sgaW5kaWNhdGluZyBhIHByb2JsZW0gaW4gY3VzdG9tZXIgY29kZVxuICAgICAgZXJyb3JSZWdleDogL2FtcGxpZnlcXC9iYWNrZW5kLyxcbiAgICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6ICdVbmFibGUgdG8gYnVpbGQgQW1wbGlmeSBiYWNrZW5kLicsXG4gICAgICByZXNvbHV0aW9uTWVzc2FnZTpcbiAgICAgICAgJ0NoZWNrIHlvdXIgYmFja2VuZCBkZWZpbml0aW9uIGluIHRoZSBgYW1wbGlmeWAgZm9sZGVyIGZvciBzeW50YXggYW5kIHR5cGUgZXJyb3JzLicsXG4gICAgICBlcnJvck5hbWU6ICdCYWNrZW5kQnVpbGRFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIC8vIFdlIGNhcHR1cmUgdGhlIHBhcmFtZXRlciBuYW1lIHRvIHNob3cgcmVsZXZhbnQgZXJyb3IgbWVzc2FnZVxuICAgICAgZXJyb3JSZWdleDpcbiAgICAgICAgL0ZhaWxlZCB0byByZXRyaWV2ZSBiYWNrZW5kIHNlY3JldCAoPzxzZWNyZXROYW1lPi4qKSBmb3IuKlBhcmFtZXRlck5vdEZvdW5kLyxcbiAgICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6IGBUaGUgc2VjcmV0IHtzZWNyZXROYW1lfSBzcGVjaWZpZWQgaW4gdGhlIGJhY2tlbmQgZG9lcyBub3QgZXhpc3QuYCxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOiBgQ3JlYXRlIHNlY3JldHMgdXNpbmcgdGhlIGNvbW1hbmQgJHt0aGlzLmZvcm1hdHRlci5ub3JtYWxpemVBbXB4Q29tbWFuZChcbiAgICAgICAgJ3NhbmRib3ggc2VjcmV0IHNldCdcbiAgICAgICl9LiBGb3IgbW9yZSBpbmZvcm1hdGlvbiwgc2VlIGh0dHBzOi8vZG9jcy5hbXBsaWZ5LmF3cy9nZW4yL2RlcGxveS1hbmQtaG9zdC9zYW5kYm94LWVudmlyb25tZW50cy9mZWF0dXJlcy8jc2V0LXNlY3JldHNgLFxuICAgICAgZXJyb3JOYW1lOiAnU2VjcmV0Tm90U2V0RXJyb3InLFxuICAgICAgY2xhc3NpZmljYXRpb246ICdFUlJPUicsXG4gICAgfSxcbiAgICB7XG4gICAgICAvLyBOb3RlIHRoYXQgdGhlIG9yZGVyIG1hdHRlcnMsIHRoaXMgc2hvdWxkIGJlIHRoZSBsYXN0IGFzIGl0IGNhcHR1cmVzIGdlbmVyaWMgQ0ZOIGVycm9yXG4gICAgICBlcnJvclJlZ2V4OiBuZXcgUmVnRXhwKFxuICAgICAgICBgRGVwbG95bWVudCBmYWlsZWQ6ICguKikke3RoaXMubXVsdGlMaW5lRW9sUmVnZXh9YFxuICAgICAgKSxcbiAgICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6ICdUaGUgQ2xvdWRGb3JtYXRpb24gZGVwbG95bWVudCBoYXMgZmFpbGVkLicsXG4gICAgICByZXNvbHV0aW9uTWVzc2FnZTpcbiAgICAgICAgJ0ZpbmQgbW9yZSBpbmZvcm1hdGlvbiBpbiB0aGUgQ2xvdWRGb3JtYXRpb24gQVdTIENvbnNvbGUgZm9yIHRoaXMgc3RhY2suJyxcbiAgICAgIGVycm9yTmFtZTogJ0Nsb3VkRm9ybWF0aW9uRGVwbG95bWVudEVycm9yJyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiAnRVJST1InLFxuICAgIH0sXG4gIF07XG59XG5cbmV4cG9ydCB0eXBlIENES0RlcGxveW1lbnRFcnJvciA9XG4gIHwgJ0FjY2Vzc0RlbmllZEVycm9yJ1xuICB8ICdCYWNrZW5kQnVpbGRFcnJvcidcbiAgfCAnQmFja2VuZFN5bnRoRXJyb3InXG4gIHwgJ0Jvb3RzdHJhcE5vdERldGVjdGVkRXJyb3InXG4gIHwgJ0NES1Jlc29sdmVBV1NBY2NvdW50RXJyb3InXG4gIHwgJ0NGTlVwZGF0ZU5vdFN1cHBvcnRlZEVycm9yJ1xuICB8ICdDbG91ZEZvcm1hdGlvbkRlcGxveW1lbnRFcnJvcidcbiAgfCAnRmlsZVBlcm1pc3Npb25zRXJyb3InXG4gIHwgJ011bHRpcGxlU2FuZGJveEluc3RhbmNlc0Vycm9yJ1xuICB8ICdFU0J1aWxkRXJyb3InXG4gIHwgJ0V4cGlyZWRUb2tlbkVycm9yJ1xuICB8ICdGaWxlQ29udmVudGlvbkVycm9yJ1xuICB8ICdGaWxlQ29udmVudGlvbkVycm9yJ1xuICB8ICdNb2R1bGVOb3RGb3VuZEVycm9yJ1xuICB8ICdTZWNyZXROb3RTZXRFcnJvcidcbiAgfCAnU3ludGF4RXJyb3InO1xuIl19